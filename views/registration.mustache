{{> header }}
<div class="container">
    <h1 class="title">Registro de Usuario</h1>
    <form action="/index.php?controller=Registration&method=register" method="POST" enctype="multipart/form-data" class="register-form">

        <div class="form-grid">

            <div class="form-group">
                <label for="nombreCompleto">Nombre completo:</label>
                <input type="text" id="nombreCompleto" name="nombreCompleto" placeholder="Ej: Melina González" required>
            </div>

            <div class="form-group">
                <label for="anioNacimiento">Año de nacimiento:</label>
                <input type="number" id="anioNacimiento" name="anioNacimiento" min="1900" max="2025" required>
            </div>

            <div class="form-group">
                <label for="sexo">Sexo:</label>
                <select id="sexo" name="sexo" required>
                    <option value="" disabled selected>Seleccioná una opción</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Femenino">Femenino</option>
                    <option value="NoCargar">Prefiero no cargarlo</option>
                </select>
            </div>

            <div class="form-group">
                <label for="username">Nombre de usuario:</label>
                <input type="text" id="username" name="username" placeholder="Elegí un nombre de usuario" required>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" placeholder="tuemail@ejemplo.com" required>
            </div>

            <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" name="password" placeholder="Mínimo 6 caracteres" minlength="6" required>
            </div>

            <div class="form-group">
                <label for="confirmarPassword">Confirmar contraseña:</label>
                <input type="password" id="confirmarPassword" name="confirmarPassword" placeholder="Repetí la contraseña" minlength="6" required>
            </div>

            <div class="form-group">
                <label for="fotoPerfil">Foto de perfil:</label>
                <input type="file" id="fotoPerfil" name="fotoPerfil" accept="image/*">
            </div>

            <div class="form-group" style="pointer-events: none;">
                <label for="ciudad">Ciudad:</label>
                <input type="text" id="ciudad" name="ciudad" placeholder="Haz click en el mapa..." readonly required>
            </div>

            <div class="form-group" style="pointer-events: none;">
                <label for="pais">País:</label>
                <input type="text" id="pais" name="pais" placeholder="Haz click en el mapa..." readonly required>
            </div>
        </div>
        <div id="mapa">

        </div>
        <button type="submit" class="btn">Registrarme</button>

        <p class="form-footer">
            ¿Ya tenés cuenta? <a href="../index.php?controller=login&method=loginForm">Iniciá sesión</a>
        </p>
    </form>
</div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    if (document.getElementById('mapa')) {
        let map = L.map('mapa').setView([-34.6037, -58.3816], 5);
        let marcador;

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: ''
        }).addTo(map);

        map.on('click', function(evento) {
            let lat = evento.latlng.lat;
            let lng = evento.latlng.lng;
            let token = "pk.4bceeb166ba6748c7eae85a1eed87707";
            if (marcador) {
                map.removeLayer(marcador);
            }

            marcador = L.marker([lat, lng]).addTo(map);

            fetch(`https://us1.locationiq.com/v1/reverse?key=${token}&lat=${lat}&lon=${lng}&format=json`)
                    .then(res => res.json())
                    .then(data => {
                        let ciudad = data.address.city ||
                                data.address.town ||
                                data.address.village ||
                                data.address.hamlet ||
                                data.address.municipality ||
                                data.address.county;
                        let pais = data.address.country;
                        document.getElementById('ciudad').value = ciudad;
                        document.getElementById('pais').value = pais;
                        marcador.bindPopup(ciudad + ', ' + pais).openPopup();
                        console.log(`Ciudad: ${ciudad}, País: ${pais}`);
                    })
                    .catch(err => console.error(err));

        });
    }
</script>
{{> footer }}